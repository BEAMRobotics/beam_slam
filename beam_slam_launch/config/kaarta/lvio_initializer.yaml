# optimization params
optimization_period: 2
lag_duration: 5

# frames
imu_frame: "imu"
lidar_frame: "velodyne"
camera_frame: "camera1"
baselink_frame: "imu"
world_frame: "world"

# calibrations
static_extrinsics: true
camera_intrinsics_path: "/home/jake/catkin_ws/src/beam_slam/beam_slam_launch/calibrations/kaarta/camera.json"
imu_intrinsics_path: "/home/jake/catkin_ws/src/beam_slam/beam_slam_launch/calibrations/kaarta/imu.json"

# sensor models
sensor_models:
  - name: 'camera'
    type: 'beam_models::camera_to_camera::VisualInertialOdom'
    motion_models: ['unicycle_3d']
    ignition: true
  - name: 'lo_initializer'
    type: 'beam_models::frame_to_frame::LoInitializer'
  # - name: 'scan_matcher_3d'
  #   type: 'beam_models::frame_to_frame::ScanMatcher3D'
  #   motion_models: ['unicycle_3d']

# motion models
motion_models:
  - name: 'unicycle_3d'
    type: 'beam_models::motion::Unicycle3D'

# solver options
solver_options:
  minimizer_type: "TRUST_REGION"
  linear_solver_type: "SPARSE_NORMAL_CHOLESKY"
  minimizer_progress_to_stdout: true
  num_threads: 6
  num_linear_solver_threads: 6
  max_num_iterations: 10
  max_solver_time_in_seconds: 1.0
  gradient_tolerance: 0.00000015
  parameter_tolerance: 0.00000015
  function_tolerance: 0.00000015

unicycle_3d:
  process_noise_diagonal: [1.0e-2, 1.0e-2, 1.0e-2,
                           1.0e-2, 1.0e-2, 1.0e-2,
                           1.0e-2, 1.0e-2, 1.0e-2,
                           1.0e-2, 1.0e-2, 1.0e-2,
                           1.0e-2, 1.0e-2, 1.0e-2]
  buffer_length: 100000


camera:
  source: "VIO"
  image_topic: "/monocular_camera/image"
  imu_topic: "/imu/data"
  init_path_topic: "/fixed_lag_smoother/lo_initializer/lo_initialiser_result"
  frame_odometry_output_topic: "/vio_init"
  descriptor: "ORB"
  window_size: 1000 # number of images to store landmark information for before clearing for new images
  num_features_to_track: 100 # number of features to track from image to image
  keyframe_parallax: 70 # if avg parallax to the previous keyframe exceeds this then set keyframe
  keyframe_tracks_drop: 150 # if number of visible landmarks in images drops below this then set keyframe
  keyframe_min_time_in_seconds: 0.5 # minimum amount of time between keyframes
  init_max_optimization_time_in_seconds: 1.0 # max amopunt of time to optimize the initializer map
  init_map_output_directory: "" # Outputs vio map into directory if not empty

lo_initializer:
  matcher_params_path: '/home/jake/catkin_ws/src/beam_slam/beam_slam_launch/config/matcher_config/loam_vlp16.json' # DEFAULT_PATH uses the appropriate config in beam_slam_launch/config/matcher_config/. Setting to empty will use the default params defined in the class
  ceres_config_path: '/home/jake/catkin_ws/src/beam_slam/beam_slam_launch/config/matcher_config/ceres_config.json'
  differential: false # Default: false
  matcher_noise: 1e-9 # Sets all diagonals on the covariance matrix to this value. Can also specify matcher_noise_diagonal instead which takes priority. Default: 1e-9.
  lidar_topic: '/velodyne_points'
  imu_topic: '/imu/data'
  output_topic: 'lo_initialiser_result'
  nominal_gravity_direction: '-Z'
  undistort_scans: true
  aggregation_time: 0.1
  trajectory_time_window: 5
  min_trajectory_distance: 1
  outlier_threshold_t_m: 0.3
  outlier_threshold_r_deg: 15
  scan_registration_map_size: 10
  scan_output_directory: '' # Outputs scans as PCD files IFF not empty

scan_matcher_3d:
  type: 'MAPLOAM' # Options: MULTIICP, MULTINDT, MULTIGICP, MULTILOAM, MAPLOAM (TODO: LIBPOINTMATCHER, TEASER)
  matcher_params_path: '/home/jake/catkin_ws/src/beam_slam/beam_slam_launch/config/matcher_config/loam_vlp16.json' # DEFAULT_PATH uses the appropriate config in beam_slam_launch/config/matcher_config/. Setting to empty will use the default params defined in the class
  registration_config_path: 'DEFAULT_PATH' # DEFAULT_PATH uses the appropriate config in beam_slam_launch/config/registration_config/. Setting to empty will use the default params defined in the class
  differential: false # Default: false
  downsample_size: 0 # voxel size (m) for downsample filter. Default: 0.03. Set to 0 for no downsampling
  matcher_noise: 1e-9 # Sets all diagonals on the covariance matrix to this value. Can also specify matcher_noise_diagonal instead which takes priority. Default: 1e-9.
  topic: '/velodyne_points'
  frame_initializer_type: 'POSEFILE' # options: ODOMETRY, POSEFILE
  frame_initializer_info: '/home/jake/data/LVIO/kaarta/trajectory_2019-07-10-16-55-15_loop_closed.ply' # for ODOMETRY: topic, for POSEFILE: path
  # scan_output_directory: '/home/nick/results/beam_slam/scans/' # Outputs scans as PCD files IFF not empty
  scan_output_directory: ''